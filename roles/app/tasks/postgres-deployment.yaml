- name: Create Postgres Deployment
  community.kubernetes.k8s:
     definition:
        kind: Deployment
        apiVersion: v1
        metadata:
          name: '{{meta.name}}'
          namespace: '{{meta.namespace}}'
        spec:
        containers:
          - name: '{{meta.name}}'
            image: postgres:10.4
            imagePullPolicy: "IfNotPresent"
            ports:
              - containerPort: 5432
            envFrom:
              - configMapRef:
                  name: '{{meta.name}}'
            volumeMounts:
                - name: postgredb
                  mountPath: /var/lib/postgresql/data
        volumes:
          - name: postgredb
            persistentVolumeClaim:
              claimName: postgres-pv-claim
